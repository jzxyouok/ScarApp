<!doctype html>
<html lang="en">
<head>
    <title>课表</title>
    [#include "common.html"]
</head>
<body>

<!--header-->
[#include "head.html"]
<ul class="week hz-hid" id="weeks">
    [@getcurrentWeekList]
        [#list weekDates as week]
            [#if week.isCurrent=='1']
                 <li id="week${week_index}" class="current" date-time="${week.date}" onclick="getkeChengBiao('${week.week}','${week_index}')">
            [#else]
                <li id="week${week_index}" date-time="${week.date}"  onclick="getkeChengBiao('${week.week}','${week_index}')">
            [/#if]
                <p>${week.week}</p>
                <p class="small">${week.monthAndDay}</p>
            </li>
        [/#list]
    [/@getcurrentWeekList]
</ul>
<ul class="ke hz-hid por"  id="weekUL">
 </ul>
[#include "foot.html"]
</body>
</html>

<script>
    getkeChengBiao(currentWeek,currentWeekIndex);
    function  getkeChengBiao(week,index){
        $("#weeks").children().removeClass("current");
        $("#week"+index).addClass("current");
        //通过week和教室查询课程表
        var classRoom="${gradename}";
        var data={"classRoom":classRoom,"week":week,"weekIndex":index};
        $.ajax({
            url :  '${base}/Course/findAllList.html',
            type : 'POST',
            timeout : '1000',
            async : false,
            dataType : 'json',
            data : data,
            success : function(r) {
                var str='';
                if(null!= r.result&&''!= r.result){
                    for(var i=0;i< r.result.length;i++){
                        var schoolTime=r.result[i].schoolTime;
                        var time=schoolTime;
                        if(time.length>4){
                            time=time.substring(0,5);
                            time=time.replace("-","");
                            time=time.replace("：",":");
                        }
                        var name=r.result[i].courseName;
                        var teacher=r.result[i].teacher;
                        var times=schoolTime.split("-");
                        var start='';//上课开始时间
                        var end='';//上课结束时间
                        var current='';//当前时间
                        if(times.length==2){
                             start=times[0].replace("：",":");
                             end=times[1].replace("：",":");
                             showTime();
                             current= $("#time").html();
                        }
                        if(current>=start&&current<=end){
                            str+='<li class="current">';
                        }else{
                            str+='<li>';
                        }

                        str+='<i>'+ time+'</i>';
                        str+='<span class="span">'+ name+'</span>';
                        str+='<div class="liright fr">'+ teacher+'</div>';
                        str+='</li>';
                    }
                    str+='<span class="db line"></span>';
                }
                $("#weekUL").empty();
                $("#weekUL").html(str);
            }
        });
    }


</script>
